---
import BaseLayout from "../layout/baseLayout.astro";
import Veranstaltung from "../components/VeranstaltungItem.astro";

const pageTitle = "Veranstaltungen";
const apiUrl = "https://data.carinthia.com/api/v4/endpoints/557ea81f-6d65-6476-9e01-d196112514d2?include=image&token=9962098a5f6c6ae8d16ad5aba95afee0";
const response = await fetch(apiUrl);
const data = await response.json();

// Extrahiere die Veranstaltungen aus dem @graph-Array
let events = [];
if (data && data["@graph"]) {
  events = data["@graph"].map((event) => {
    return {
      id: event["@id"],
      title: event.name,
      description: event.description,
      startDate: event.startDate,
      endDate: event.endDate,
      imageUrl: event.image?.[0]?.dc?.dynamicDefaultUrl || "" // Extrahiere das Bild, falls vorhanden
    };
  });
} else {
  console.error("Keine Veranstaltungsdaten gefunden");
}

---
<BaseLayout pageTitle={pageTitle}>

	<p>Das sind alle Veranstaltungen:</p>
  
	{events.length > 0 ? (
	  <ul>
		{events.map((event) => (
		  <Veranstaltung 
			url={`/veranstaltungen/${event.id}`} 
			title={event.title} 
			description={event.description} 
			startDate={event.startDate} 
			endDate={event.endDate} 
			imageUrl={event.imageUrl}
		  />
		))}
	  </ul>
	) : (
	  <p>Keine Veranstaltungen verfÃ¼gbar.</p>
	)}
	
</BaseLayout>

